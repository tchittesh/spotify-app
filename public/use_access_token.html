<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="temp" content="width=device-width, initial-scale=1">
<body>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>
  (function() {

    var stateKey = 'spotify_auth_state';

    function getHashParams() {
      var hashParams = {};
      var e, r = /([^&;=]+)=?([^&;]*)/g,
          q = window.location.hash.substring(1);
      while ( e = r.exec(q)) {
         hashParams[e[1]] = decodeURIComponent(e[2]);
      }
      return hashParams;
    }

    var params = getHashParams();

    var access_token = params.access_token;

    if (access_token) {
      $.ajax({
        url: 'https://api.spotify.com/v1/me/top/tracks',
        headers: {
          'Authorization': 'Bearer ' + access_token
        },
        success: function(response) {
          $.get("/loggedinh", {userinfo : JSON.stringify(response)}, function(data) {
            window.location.href = 'endh.html#'+data;
          } );
        }
      })
    }
  })();
</script>
</body>
</html>
