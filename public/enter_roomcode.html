
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
table{background-color:#87CEEB;}
td,th{border:1px solid #aaa;text-align:left;padding:8px}
td{background-color:#fff}
th{background-color:#c4c4c4}
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif}
body {
    background-image: url("");
    background-repeat: no-repeat;
    background-position: right top;
    margin-right: 200px;
    background-attachment: fixed;
}
</style></head>
<body class="w3-light-grey">

    <header class="w3-container w3-light-blue w3-center w3-margin-top w3-card">
  <h2><font style="font:115%/1.3 Arial,Helvetica,sans-serif"> Type of Viewer </font></h2>
</header>
<div align=CENTER>
  <br />
  <form>
    Enter your room code: <input id='rcode-input' type="text" name="rcode"><br>
    <br />
    Enter your name: <input id='name-input' type="text" name="username"><br>
  </form>
  <br />
  <a id="login-group" class="btn btn-primary">Submit</a>
</div>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>
  (function() {
    var stateKey = 'spotify_auth_state';

    function getHashParams() {
      var hashParams = {};
      var e, r = /([^&;=]+)=?([^&;]*)/g,
          q = window.location.hash.substring(1);
      while ( e = r.exec(q)) {
         hashParams[e[1]] = decodeURIComponent(e[2]);
      }
      return hashParams;
    }

    var params = getHashParams();

    var access_token = params.access_token;

    if (access_token) {
      $.ajax({
        url: 'https://api.spotify.com/v1/me/top/tracks',
        headers: {
          'Authorization': 'Bearer ' + access_token
        },
        success: function(response) {
          $.get("/loggeding", {userinfo : JSON.stringify(response)});
          window.location.href = 'endg.html';
          // $.get("/loggedinh", {userinfo : JSON.stringify(response)}, function(data) {
          //   window.location.href = 'endh.html#'+data;
          // } );
        },
        error: function(error) {
          alert(error);
        }
      })
    } else {
      alert('fail');
      window.location.href = 'endg.html';
    }

    document.getElementById('login-group').addEventListener('click', function() {
      var client_id = 'c4afbd083ef34b34810c5b3c16a2e08d'; // Your client id
      var redirect_uri = 'http://localhost:8000/callbackg'; // Your redirect uri
      var scope = 'user-read-private user-read-email user-top-read';
      var url = 'https://accounts.spotify.com/authorize';
      url += '?response_type=token';
      url += '&client_id=' + encodeURIComponent(client_id);
      url += '&scope=' + encodeURIComponent(scope);
      url += '&redirect_uri=' + encodeURIComponent(redirect_uri);

      console.log(url);
      window.location = url;
    }, false);
  })();
</script>
</body>
</html>
